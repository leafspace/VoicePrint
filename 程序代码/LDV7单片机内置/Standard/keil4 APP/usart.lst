C51 COMPILER V9.00   USART                                                                 06/12/2018 12:46:28 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN ..\obj\usart.obj
COMPILER INVOKED BY: C:\NSProgram\Keil\C51\BIN\C51.EXE ..\user\usart.c COMPACT BROWSE INCDIR(..\code;..\user) DEBUG OBJ
                    -ECTEXTEND PRINT(.\usart.lst) OBJECT(..\obj\usart.obj)

line level    source

   1          /***************************飞音云电子****************************
   2          **  工程名称：YS-V0.7语音识别模块驱动程序
   3          **      CPU: STC11L08XE
   4          **      晶振：22.1184MHZ
   5          **      波特率：9600 bit/S
   6          **      配套产品信息：YS-V0.7语音识别开发板
   7          **                http://yuesheng001.taobao.com
   8          **  作者：zdings
   9          **  联系：751956552@qq.com
  10          **  修改日期：2013.9.13
  11          **  说明：口令模式： 即每次识别时都需要说“小杰”这个口令 ，才能够进行下
             -级的识别
  12          /***************************飞音云电子******************************/
  13          #include "config.h"
  14          #define FOSC 22118400L                                                      // System frequency
  15          uint32_t baud = 9600;                                                       // UART baudrate
  16          
  17          /************************************************************************
  18          函 数 名： 串口初始化
  19          功能描述： STC10L08XE 单片机串口初始化函数
  20          返回函数： none
  21          其他说明： none
  22          **************************************************************************/
  23          void UartIni(void)
  24          {
  25   1              SCON = 0x50;            //8-bit variable UART
  26   1              TMOD = 0x20;            //Set Timer1 as 8-bit auto reload mode
  27   1              TH1 = TL1 = -(FOSC / 12 / 32 / baud); //Set auto-reload vaule
  28   1              TR1 = 1;                //Timer1 start run
  29   1              ES = 1;                 //Enable UART interrupt
  30   1              EA = 1;                 //Open master interrupt switch
  31   1      }
  32          
  33          /***********************************************************
  34          * 名    称： 
  35          * 功    能： 
  36          * 入口参数： 无 
  37          * 出口参数：无
  38          * 说    明：                                          
  39          **********************************************************/
  40          void Uart_Isr() interrupt 4 using 1
  41          {
  42   1              if (RI)
  43   1              {
  44   2      
  45   2              }
  46   1      
  47   1      }
  48          
  49          /************************************************************************
  50          功能描述：         串口发送一字节数据
  51          入口参数： DAT:带发送的数据
  52          返 回 值：  none
  53          其他说明： none
C51 COMPILER V9.00   USART                                                                 06/12/2018 12:46:28 PAGE 2   

  54          **************************************************************************/
  55          void UARTSendByte(uint8_t DAT)
  56          {
  57   1              ES = 0;
  58   1              TI = 0;
  59   1              SBUF = DAT;
  60   1              while (TI == 0);
  61   1              TI = 0;
  62   1              ES = 1;
  63   1      }
  64          
  65          /************************************************************************
  66          功能描述： 串口发送字符串数据
  67          入口参数：         *DAT：字符串指针
  68          返 回 值： none
  69          其他说明： API 供外部使用，直观！
  70          **************************************************************************/
  71          void PrintCom(uint8_t *DAT)
  72          {
  73   1              while (*DAT)
  74   1              {
  75   2                      UARTSendByte(*DAT++);
  76   2              }
  77   1      }
  78          
  79          /************************************************************************
  80          功能描述： 打印积蓄的识别关键词列表
  81          入口参数：         
  82          返 回 值： none
  83          其他说明： 发送给树莓派的消息
  84                                  例：<LDV7 REG>4 6 20</LDV7 REG>
  85                                  代表意义：拷贝 1 张
  86          **************************************************************************/
  87          void PrintComReg(void)
  88          {
  89   1              uint8_t i = 0;                                                          // 循环变量
  90   1              uint8_t temp[COMBUFFERSIZE] = { 0 };                                    // 临时保存的字符串
  91   1              uint8_t buffer[COMBUFFERSIZE] = { 0 };                                  // 发送给树莓派的内容
  92   1              strcat(buffer, "<LDV7 REG>");
  93   1              for (i = 0; i < commondQueue.queueLength; ++i) {                        // 遍历队列中的识别过的
             -数据
  94   2                      sprintf(temp, "%d", commondQueue.commondQueue[i]);                  // 将数据格式化
  95   2                      strcat(buffer, temp);
  96   2                      if ((i + 1) != commondQueue.queueLength) {
  97   3                              strcat(buffer, " ");
  98   3                      }
  99   2              }
 100   1              commondQueue.queueLength = 0;                                           // 清空识别队列
 101   1              strcat(buffer, "</LDV7 REG>\r\n");
 102   1              PrintCom(buffer);                                                       // 发送串口消息
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    319    ----
   CONSTANT SIZE    =    130    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      2     104
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.00   USART                                                                 06/12/2018 12:46:28 PAGE 3   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
